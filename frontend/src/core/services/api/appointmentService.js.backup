import apiClient from '../../../core/services/api/base';

/**
 * Servicio de Citas (Appointments)
 * Maneja todas las operaciones relacionadas con citas dentales
 */
export const appointmentService = {
    /**
     * Obtener todas las citas
     * @returns {Promise} Lista de todas las citas
     */
    getAll: async () => {
        try {
            const response = await apiClient.get('/appointments');
            return response.data;
        } catch (error) {
            console.error('Error fetching appointments:', error);
            throw error;
        }
    },

    /**
     * Obtener cita por ID
     * @param {string|number} id - ID de la cita
     * @returns {Promise} Datos de la cita
     */
    getById: async (id) => {
        try {
            const response = await apiClient.get(`/appointments/${id}`);
            return response.data;
        } catch (error) {
            console.error(`Error fetching appointment ${id}:`, error);
            throw error;
        }
    },

    /**
     * Crear nueva cita
     * @param {Object} appointmentData - Datos de la cita
     * @returns {Promise} Cita creada
     */
    create: async (appointmentData) => {
        try {
            const response = await apiClient.post('/appointments', appointmentData);
            return response.data;
        } catch (error) {
            console.error('Error creating appointment:', error);
            throw error;
        }
    },

    /**
     * Actualizar cita existente
     * @param {string|number} id - ID de la cita
     * @param {Object} appointmentData - Datos actualizados
     * @returns {Promise} Cita actualizada
     */
    update: async (id, appointmentData) => {
        try {
            const response = await apiClient.put(`/appointments/${id}`, appointmentData);
            return response.data;
        } catch (error) {
            console.error(`Error updating appointment ${id}:`, error);
            throw error;
        }
    },

    /**
     * Eliminar cita
     * @param {string|number} id - ID de la cita
     * @returns {Promise} Confirmación de eliminación
     */
    delete: async (id) => {
        try {
            const response = await apiClient.delete(`/appointments/${id}`);
            return response.data;
        } catch (error) {
            console.error(`Error deleting appointment ${id}:`, error);
            throw error;
        }
    },

    /**
     * Obtener citas por fecha específica
     * @param {string} date - Fecha en formato YYYY-MM-DD
     * @returns {Promise} Lista de citas del día
     */
    getByDate: async (date) => {
        try {
            const response = await apiClient.get(`/appointments/date/${date}`);
            return response.data;
        } catch (error) {
            console.error(`Error fetching appointments for date ${date}:`, error);
            throw error;
        }
    },

    /**
     * Obtener citas por rango de fechas
     * @param {string} startDate - Fecha inicial YYYY-MM-DD
     * @param {string} endDate - Fecha final YYYY-MM-DD
     * @returns {Promise} Lista de citas en el rango
     */
    getByDateRange: async (startDate, endDate) => {
        try {
            const response = await apiClient.get(`/appointments?startDate=${startDate}&endDate=${endDate}`);
            return response.data;
        } catch (error) {
            console.error(`Error fetching appointments for date range:`, error);
            throw error;
        }
    },

    /**
     * Obtener citas de un paciente
     * @param {string|number} patientId - ID del paciente
     * @returns {Promise} Lista de citas del paciente
     */
    getByPatient: async (patientId) => {
        try {
            const response = await apiClient.get(`/appointments/patient/${patientId}`);
            return response.data;
        } catch (error) {
            console.error(`Error fetching appointments for patient ${patientId}:`, error);
            throw error;
        }
    },

    /**
     * Obtener citas de un dentista
     * @param {string|number} dentistId - ID del dentista
     * @returns {Promise} Lista de citas del dentista
     */
    getByDentist: async (dentistId) => {
        try {
            const response = await apiClient.get(`/appointments/dentist/${dentistId}`);
            return response.data;
        } catch (error) {
            console.error(`Error fetching appointments for dentist ${dentistId}:`, error);
            throw error;
        }
    },

    /**
     * Obtener citas del día actual
     * @returns {Promise} Lista de citas de hoy
     */
    getToday: async () => {
        try {
            const response = await apiClient.get('/appointments/today');
            return response.data;
        } catch (error) {
            console.error('Error fetching today\'s appointments:', error);
            throw error;
        }
    },

    /**
     * Obtener citas pendientes (solicitudes)
     * @returns {Promise} Lista de citas pendientes
     */
    getPending: async () => {
        try {
            const response = await apiClient.get('/appointments/pending');
            return response.data;
        } catch (error) {
            console.error('Error fetching pending appointments:', error);
            throw error;
        }
    },

    /**
     * Confirmar una cita pendiente
     * @param {string|number} id - ID de la cita
     * @param {Object} confirmData - Datos de confirmación
     * @returns {Promise} Cita confirmada
     */
    confirm: async (id, confirmData = {}) => {
        try {
            const response = await apiClient.patch(`/appointments/${id}/confirm`, confirmData);
            return response.data;
        } catch (error) {
            console.error(`Error confirming appointment ${id}:`, error);
            throw error;
        }
    },

    /**
     * Cancelar una cita
     * @param {string|number} id - ID de la cita
     * @param {Object} cancelData - Datos de cancelación (razón, etc.)
     * @returns {Promise} Cita cancelada
     */
    cancel: async (id, cancelData = {}) => {
        try {
            const response = await apiClient.patch(`/appointments/${id}/cancel`, cancelData);
            return response.data;
        } catch (error) {
            console.error(`Error cancelling appointment ${id}:`, error);
            throw error;
        }
    },

    /**
     * Completar una cita
     * @param {string|number} id - ID de la cita
     * @param {Object} completionData - Datos de finalización
     * @returns {Promise} Cita completada
     */
    complete: async (id, completionData = {}) => {
        try {
            const response = await apiClient.patch(`/appointments/${id}/complete`, completionData);
            return response.data;
        } catch (error) {
            console.error(`Error completing appointment ${id}:`, error);
            throw error;
        }
    },

    /**
     * Reprogramar una cita
     * @param {string|number} id - ID de la cita
     * @param {Object} rescheduleData - Nueva fecha y hora
     * @returns {Promise} Cita reprogramada
     */
    reschedule: async (id, rescheduleData) => {
        try {
            const response = await apiClient.patch(`/appointments/${id}/reschedule`, rescheduleData);
            return response.data;
        } catch (error) {
            console.error(`Error rescheduling appointment ${id}:`, error);
            throw error;
        }
    },

    /**
     * Verificar disponibilidad de horario
     * @param {Object} availabilityData - Fecha, hora, dentista
     * @returns {Promise} Disponibilidad
     */
    checkAvailability: async (availabilityData) => {
        try {
            const response = await apiClient.post('/appointments/check-availability', availabilityData);
            return response.data;
        } catch (error) {
            console.error('Error checking availability:', error);
            throw error;
        }
    },
};

export default appointmentService;
